# ForgeLedger Test -- API Physics (v0.1)
# Canonical API specification for financial transaction tracking system

info:
  title: "ForgeLedger Test API"
  version: "0.1.0"
  description: "Lightweight financial ledger for tracking income and expenses with unified transaction view"

paths:

  # -- Health -------------------------------------------------------

  /health:
    get:
      summary: "Health check endpoint"
      auth: none
      response:
        status: "ok"
        timestamp: string

  /health/db:
    get:
      summary: "Database connectivity health check"
      auth: none
      response:
        status: "ok" | "degraded" | "down"
        database: "connected" | "disconnected"
        latency_ms: number

  # -- Transactions -------------------------------------------------

  /transactions:
    post:
      summary: "Create a new transaction (income or expense)"
      auth: none
      request:
        amount: number (required, positive decimal, max 2 decimals)
        type: string (required, enum: "income" | "expense")
        category_id: uuid (required)
        date: string (required, ISO 8601 date format YYYY-MM-DD)
        description: string (optional, max 1000 chars)
      response:
        id: uuid
        amount: number
        type: string
        category_id: uuid
        category_name: string
        date: string
        description: string | null
        created_at: datetime

    get:
      summary: "List all transactions with optional filtering and pagination"
      auth: none
      query:
        type: string (optional, enum: "income" | "expense")
        category_id: uuid (optional)
        date_from: string (optional, ISO 8601 date)
        date_to: string (optional, ISO 8601 date)
        limit: integer (optional, default 50, max 200)
        offset: integer (optional, default 0)
        sort_by: string (optional, enum: "date" | "amount" | "created_at", default "date")
        sort_order: string (optional, enum: "asc" | "desc", default "desc")
      response:
        items: Transaction[]
        total: integer
        limit: integer
        offset: integer
        summary:
          total_income: number
          total_expense: number
          net_balance: number
          transaction_count: integer

  /transactions/{id}:
    get:
      summary: "Get a specific transaction by ID"
      auth: none
      response:
        id: uuid
        amount: number
        type: string
        category_id: uuid
        category_name: string
        date: string
        description: string | null
        created_at: datetime

    put:
      summary: "Update an existing transaction"
      auth: none
      request:
        amount: number (optional, positive decimal, max 2 decimals)
        type: string (optional, enum: "income" | "expense")
        category_id: uuid (optional)
        date: string (optional, ISO 8601 date)
        description: string (optional, max 1000 chars)
      response:
        id: uuid
        amount: number
        type: string
        category_id: uuid
        category_name: string
        date: string
        description: string | null
        created_at: datetime
        updated_at: datetime

    delete:
      summary: "Delete a transaction"
      auth: none
      response:
        status: "deleted"
        id: uuid

  # -- Categories ---------------------------------------------------

  /categories:
    post:
      summary: "Create a new category"
      auth: none
      request:
        name: string (required, min 1, max 100, unique)
        type: string (required, enum: "income" | "expense")
      response:
        id: uuid
        name: string
        type: string
        transaction_count: integer

    get:
      summary: "List all categories with optional filtering"
      auth: none
      query:
        type: string (optional, enum: "income" | "expense")
        sort_by: string (optional, enum: "name" | "transaction_count", default "name")
        sort_order: string (optional, enum: "asc" | "desc", default "asc")
      response:
        items: CategoryWithStats[]
        total: integer

  /categories/{id}:
    get:
      summary: "Get a specific category by ID with usage statistics"
      auth: none
      response:
        id: uuid
        name: string
        type: string
        transaction_count: integer
        total_amount: number
        recent_transactions: TransactionSummary[]

    put:
      summary: "Update a category"
      auth: none
      request:
        name: string (optional, min 1, max 100, unique)
        type: string (optional, enum: "income" | "expense")
      response:
        id: uuid
        name: string
        type: string
        transaction_count: integer

    delete:
      summary: "Delete a category (only if no transactions reference it)"
      auth: none
      response:
        status: "deleted"
        id: uuid

  # -- Dashboard & Analytics ----------------------------------------

  /dashboard/summary:
    get:
      summary: "Get dashboard summary statistics for specified date range"
      auth: none
      query:
        date_from: string (optional, ISO 8601 date, default: 30 days ago)
        date_to: string (optional, ISO 8601 date, default: today)
      response:
        period:
          from: string
          to: string
        totals:
          income: number
          expense: number
          net: number
        transaction_count:
          income: integer
          expense: integer
          total: integer
        top_income_categories: CategoryTotal[]
        top_expense_categories: CategoryTotal[]
        recent_transactions: Transaction[]

  /dashboard/trends:
    get:
      summary: "Get time-series data for income and expense trends"
      auth: none
      query:
        date_from: string (required, ISO 8601 date)
        date_to: string (required, ISO 8601 date)
        granularity: string (optional, enum: "day" | "week" | "month", default "day")
      response:
        period:
          from: string
          to: string
          granularity: string
        data_points: TrendDataPoint[]

  /dashboard/category-breakdown:
    get:
      summary: "Get spending breakdown by category for pie charts and analysis"
      auth: none
      query:
        type: string (required, enum: "income" | "expense")
        date_from: string (optional, ISO 8601 date)
        date_to: string (optional, ISO 8601 date)
      response:
        type: string
        period:
          from: string | null
          to: string | null
        total: number
        categories: CategoryBreakdown[]

  # -- Bulk Operations ----------------------------------------------

  /transactions/bulk:
    post:
      summary: "Create multiple transactions in a single request"
      auth: none
      request:
        transactions: TransactionCreate[] (required, max 100 items)
      response:
        created: Transaction[]
        failed: BulkOperationError[]
        summary:
          total_attempted: integer
          successful: integer
          failed: integer

    delete:
      summary: "Delete multiple transactions by ID list"
      auth: none
      request:
        transaction_ids: uuid[] (required, max 100 items)
      response:
        deleted: uuid[]
        failed: BulkOperationError[]
        summary:
          total_attempted: integer
          successful: integer
          failed: integer

  # -- Export & Import ----------------------------------------------

  /export/transactions:
    get:
      summary: "Export transactions as CSV"
      auth: none
      query:
        type: string (optional, enum: "income" | "expense")
        category_id: uuid (optional)
        date_from: string (optional, ISO 8601 date)
        date_to: string (optional, ISO 8601 date)
        format: string (optional, enum: "csv" | "json", default "csv")
      response:
        content_type: "text/csv" | "application/json"
        body: CSV or JSON file download

  /import/transactions:
    post:
      summary: "Import transactions from CSV file"
      auth: none
      request:
        content_type: "multipart/form-data"
        file: binary (CSV file)
        options:
          skip_duplicates: boolean (optional, default true)
          validate_only: boolean (optional, default false)
      response:
        imported: Transaction[]
        skipped: ImportSkippedRecord[]
        errors: ImportError[]
        summary:
          total_rows: integer
          imported: integer
          skipped: integer
          errors: integer

  # -- Data Validation & Reference Data -----------------------------

  /validation/transaction:
    post:
      summary: "Validate transaction data without creating record"
      auth: none
      request:
        amount: number (required)
        type: string (required)
        category_id: uuid (required)
        date: string (required)
        description: string (optional)
      response:
        valid: boolean
        errors: ValidationError[]

  /reference/date-ranges:
    get:
      summary: "Get predefined date range options for filtering"
      auth: none
      response:
        ranges: DateRangeOption[]

schemas:

  Transaction:
    id: uuid
    amount: number
    type: string
    category_id: uuid
    category_name: string
    date: string
    description: string | null
    created_at: datetime

  TransactionCreate:
    amount: number
    type: string
    category_id: uuid
    date: string
    description: string | null

  TransactionSummary:
    id: uuid
    amount: number
    type: string
    date: string
    description: string | null

  Category:
    id: uuid
    name: string
    type: string

  CategoryWithStats:
    id: uuid
    name: string
    type: string
    transaction_count: integer
    total_amount: number
    last_used: datetime | null

  CategoryTotal:
    category_id: uuid
    category_name: string
    total: number
    count: integer
    percentage: number

  CategoryBreakdown:
    category_id: uuid
    category_name: string
    amount: number
    transaction_count: integer
    percentage: number

  TrendDataPoint:
    date: string
    income: number
    expense: number
    net: number
    transaction_count: integer

  BulkOperationError:
    index: integer
    transaction_id: uuid | null
    error: string
    details: object

  ValidationError:
    field: string
    message: string
    code: string

  ImportSkippedRecord:
    row: integer
    reason: string
    data: object

  ImportError:
    row: integer
    field: string | null
    message: string
    value: string | null

  DateRangeOption:
    label: string
    value: string
    date_from: string
    date_to: string