# ForgeLedger Test -- API Physics (v0.1)
# Canonical API specification for financial ledger transaction tracking

info:
  title: "ForgeLedger Test API"
  version: "0.1.0"
  description: "Lightweight financial ledger for tracking income and expenses with categorization and unified transaction view"

paths:

  # -- Health -------------------------------------------------------

  /health:
    get:
      summary: "Health check endpoint"
      auth: none
      response:
        status: "ok"

  /health/version:
    get:
      summary: "Return application version and build information"
      auth: none
      response:
        version: string
        build_date: string

  # -- Transactions -------------------------------------------------

  /transactions:
    post:
      summary: "Create a new transaction (income or expense)"
      auth: none
      request:
        amount: decimal (required, positive, max 2 decimal places)
        type: string (required, enum: "income" | "expense")
        category_id: uuid (required)
        date: date (required, ISO format YYYY-MM-DD)
        description: string (optional, max 1000 chars)
      response:
        id: uuid
        amount: decimal
        type: string
        category_id: uuid
        category_name: string
        date: date
        description: string | null
        created_at: datetime

    get:
      summary: "List all transactions with optional filtering and pagination"
      auth: none
      query:
        type: string (optional, enum: "income" | "expense")
        category_id: uuid (optional)
        date_from: date (optional, ISO format YYYY-MM-DD)
        date_to: date (optional, ISO format YYYY-MM-DD)
        limit: integer (optional, default 50, max 500)
        offset: integer (optional, default 0)
        sort_by: string (optional, default "date", enum: "date" | "amount" | "created_at")
        sort_order: string (optional, default "desc", enum: "asc" | "desc")
      response:
        items: TransactionDetail[]
        total: integer
        summary:
          total_income: decimal
          total_expense: decimal
          net_balance: decimal
          filtered_income: decimal
          filtered_expense: decimal
          filtered_balance: decimal

  /transactions/{id}:
    get:
      summary: "Get a specific transaction by ID with full details"
      auth: none
      response:
        id: uuid
        amount: decimal
        type: string
        category_id: uuid
        category_name: string
        date: date
        description: string | null
        created_at: datetime

    put:
      summary: "Update an existing transaction"
      auth: none
      request:
        amount: decimal (optional, positive, max 2 decimal places)
        type: string (optional, enum: "income" | "expense")
        category_id: uuid (optional)
        date: date (optional, ISO format YYYY-MM-DD)
        description: string (optional, max 1000 chars)
      response:
        id: uuid
        amount: decimal
        type: string
        category_id: uuid
        category_name: string
        date: date
        description: string | null
        created_at: datetime
        updated_at: datetime

    delete:
      summary: "Delete a transaction permanently"
      auth: none
      response:
        status: "deleted"
        id: uuid

  # -- Transaction Summaries ----------------------------------------

  /transactions/summary:
    get:
      summary: "Get aggregated transaction summary data"
      auth: none
      query:
        date_from: date (optional, ISO format YYYY-MM-DD)
        date_to: date (optional, ISO format YYYY-MM-DD)
        group_by: string (optional, enum: "month" | "category" | "type")
      response:
        total_income: decimal
        total_expense: decimal
        net_balance: decimal
        transaction_count: integer
        groups: SummaryGroup[]

  /transactions/summary/category:
    get:
      summary: "Get transaction summary grouped by category"
      auth: none
      query:
        date_from: date (optional, ISO format YYYY-MM-DD)
        date_to: date (optional, ISO format YYYY-MM-DD)
        type: string (optional, enum: "income" | "expense")
      response:
        categories: CategorySummary[]

  /transactions/summary/monthly:
    get:
      summary: "Get monthly transaction summary for trend analysis"
      auth: none
      query:
        months: integer (optional, default 12, max 36)
      response:
        months: MonthlySummary[]

  # -- Categories ---------------------------------------------------

  /categories:
    post:
      summary: "Create a new transaction category"
      auth: none
      request:
        name: string (required, min 1, max 100, unique)
        type: string (required, enum: "income" | "expense")
      response:
        id: uuid
        name: string
        type: string
        transaction_count: integer

    get:
      summary: "List all categories with transaction counts"
      auth: none
      query:
        type: string (optional, enum: "income" | "expense")
      response:
        items: CategoryWithStats[]

  /categories/{id}:
    get:
      summary: "Get a specific category with statistics"
      auth: none
      response:
        id: uuid
        name: string
        type: string
        transaction_count: integer
        total_amount: decimal
        recent_transactions: TransactionSummary[]

    put:
      summary: "Update a category name or type"
      auth: none
      request:
        name: string (optional, min 1, max 100, unique)
        type: string (optional, enum: "income" | "expense")
      response:
        id: uuid
        name: string
        type: string
        transaction_count: integer

    delete:
      summary: "Delete a category (fails if transactions exist)"
      auth: none
      response:
        status: "deleted"
        id: uuid

  /categories/{id}/transactions:
    get:
      summary: "List all transactions for a specific category"
      auth: none
      query:
        date_from: date (optional, ISO format YYYY-MM-DD)
        date_to: date (optional, ISO format YYYY-MM-DD)
        limit: integer (optional, default 50, max 500)
        offset: integer (optional, default 0)
      response:
        items: TransactionDetail[]
        total: integer
        category:
          id: uuid
          name: string
          type: string

  # -- Dashboard Data -----------------------------------------------

  /dashboard:
    get:
      summary: "Get comprehensive dashboard data including recent transactions and summaries"
      auth: none
      query:
        recent_limit: integer (optional, default 10, max 50)
      response:
        summary:
          total_income: decimal
          total_expense: decimal
          net_balance: decimal
          current_month_income: decimal
          current_month_expense: decimal
          current_month_balance: decimal
        recent_transactions: TransactionDetail[]
        top_income_categories: CategorySummary[]
        top_expense_categories: CategorySummary[]
        monthly_trend: MonthlySummary[]

  # -- Bulk Operations ----------------------------------------------

  /transactions/bulk:
    post:
      summary: "Create multiple transactions in a single request"
      auth: none
      request:
        transactions: TransactionCreate[] (max 100 items)
      response:
        created: TransactionDetail[]
        failed: BulkOperationError[]
        summary:
          total: integer
          succeeded: integer
          failed: integer

    delete:
      summary: "Delete multiple transactions by ID"
      auth: none
      request:
        ids: uuid[] (required, max 100 items)
      response:
        deleted: uuid[]
        failed: BulkOperationError[]
        summary:
          total: integer
          succeeded: integer
          failed: integer

  # -- Export -------------------------------------------------------

  /transactions/export:
    get:
      summary: "Export transactions as CSV file"
      auth: none
      query:
        type: string (optional, enum: "income" | "expense")
        category_id: uuid (optional)
        date_from: date (optional, ISO format YYYY-MM-DD)
        date_to: date (optional, ISO format YYYY-MM-DD)
        format: string (optional, default "csv", enum: "csv" | "json")
      response:
        content_type: "text/csv" | "application/json"
        filename: string
        data: file download

  # -- Validation ---------------------------------------------------

  /transactions/validate:
    post:
      summary: "Validate transaction data without creating"
      auth: none
      request:
        amount: decimal
        type: string
        category_id: uuid
        date: date
        description: string | null
      response:
        valid: boolean
        errors: ValidationError[]

  /categories/validate:
    post:
      summary: "Validate category data without creating"
      auth: none
      request:
        name: string
        type: string
      response:
        valid: boolean
        errors: ValidationError[]
        name_available: boolean

# -- Schemas ------------------------------------------------------

schemas:

  TransactionDetail:
    id: uuid
    amount: decimal
    type: string
    category_id: uuid
    category_name: string
    date: date
    description: string | null
    created_at: datetime
    updated_at: datetime | null

  TransactionSummary:
    id: uuid
    amount: decimal
    type: string
    category_name: string
    date: date
    description: string | null

  TransactionCreate:
    amount: decimal
    type: string
    category_id: uuid
    date: date
    description: string | null

  CategoryWithStats:
    id: uuid
    name: string
    type: string
    transaction_count: integer
    total_amount: decimal
    last_used: datetime | null

  CategorySummary:
    id: uuid
    name: string
    type: string
    amount: decimal
    transaction_count: integer
    percentage: decimal

  SummaryGroup:
    key: string
    label: string
    income: decimal
    expense: decimal
    balance: decimal
    transaction_count: integer

  MonthlySummary:
    month: string
    year: integer
    income: decimal
    expense: decimal
    balance: decimal
    transaction_count: integer

  BulkOperationError:
    index: integer
    item_id: uuid | null
    error: string
    details: object | null

  ValidationError:
    field: string
    message: string
    code: string

  ErrorResponse:
    error: string
    message: string
    details: object | null
    timestamp: datetime